'use strict';

const {
  promises: dns
} = require('dns');

const React = require('react');

const {
  useState,
  useEffect
} = require('react');

const {
  Box,
  Text,
  Newline,
  useApp
} = require('ink');

const Spinner = require('ink-spinner').default;

const api = require('./api.js');

const FixedSpacer = ({
  size
}) => /*#__PURE__*/React.createElement(React.Fragment, null, ' '.repeat(size));

const ErrorMessage = ({
  text
}) => /*#__PURE__*/React.createElement(Box, null, /*#__PURE__*/React.createElement(Text, {
  bold: true,
  color: "red"
}, "\u203A", /*#__PURE__*/React.createElement(FixedSpacer, {
  size: 1
})), /*#__PURE__*/React.createElement(Text, {
  dimColor: true
}, text), /*#__PURE__*/React.createElement(Newline, {
  count: 2
}));

const Spacer = ({
  singleLine
}) => {
  if (singleLine) {
    return null;
  }

  return /*#__PURE__*/React.createElement(Text, null, /*#__PURE__*/React.createElement(Newline, {
    count: 1
  }));
};

const DownloadSpeed = ({
  isDone,
  downloadSpeed,
  uploadSpeed,
  downloadUnit
} = {}) => {
  const color = isDone || uploadSpeed ? 'green' : 'cyan';
  return /*#__PURE__*/React.createElement(Text, {
    color: color
  }, downloadSpeed, /*#__PURE__*/React.createElement(FixedSpacer, {
    size: 1
  }), /*#__PURE__*/React.createElement(Text, {
    dimColor: true
  }, downloadUnit), /*#__PURE__*/React.createElement(FixedSpacer, {
    size: 1
  }), "\u2193");
};

const UploadSpeed = ({
  isDone,
  uploadSpeed,
  uploadUnit
} = {}) => {
  const color = isDone ? 'green' : 'cyan';

  if (uploadSpeed) {
    return /*#__PURE__*/React.createElement(Text, {
      color: color
    }, uploadSpeed, /*#__PURE__*/React.createElement(Text, {
      dimColor: true
    }, ` ${uploadUnit} ↑`));
  }

  return /*#__PURE__*/React.createElement(Text, {
    dimColor: true,
    color: color
  }, ' - Mbps ↑');
};

const Speed = ({
  upload,
  data
}) => upload ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(DownloadSpeed, data), /*#__PURE__*/React.createElement(Text, {
  dimColor: true
}, ' / '), /*#__PURE__*/React.createElement(UploadSpeed, data)) : /*#__PURE__*/React.createElement(DownloadSpeed, data);

const Fast = ({
  singleLine,
  upload
}) => {
  const [error, setError] = useState('');
  const [data, setData] = useState({});
  const [isDone, setIsDone] = useState(false);
  const {
    exit
  } = useApp();
  useEffect(() => {
    (async () => {
      try {
        await dns.lookup('fast.com');
      } catch (error) {
        setError(error.code === 'ENOTFOUND' ? 'Please check your internet connection' : `Something happened ${JSON.stringify(error)}`);
        exit();
        return;
      } // eslint-disable-next-line unicorn/no-array-for-each


      api({
        measureUpload: upload
      }).forEach(result => {
        setData(result);
      }).catch(error_ => {
        // eslint-disable-line promise/prefer-await-to-then
        setError(error_.message);
        exit();
      });
    })();
  }, [exit, upload]);
  useEffect(() => {
    if (data.isDone || !upload && data.uploadSpeed) {
      setIsDone(true);
    }
  }, [data.isDone, upload, data.uploadSpeed]);
  useEffect(() => {
    if (isDone) {
      exit();
    }
  }, [isDone, exit]);

  if (error) {
    return /*#__PURE__*/React.createElement(ErrorMessage, {
      text: error
    });
  }

  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Spacer, {
    singleLine: singleLine
  }), /*#__PURE__*/React.createElement(Box, null, !isDone && /*#__PURE__*/React.createElement(React.Fragment, null, !singleLine && /*#__PURE__*/React.createElement(Text, null, /*#__PURE__*/React.createElement(FixedSpacer, {
    size: 2
  })), /*#__PURE__*/React.createElement(Text, {
    color: "cyan"
  }, /*#__PURE__*/React.createElement(Spinner, null)), /*#__PURE__*/React.createElement(Text, null, /*#__PURE__*/React.createElement(FixedSpacer, {
    size: 1
  }))), isDone && /*#__PURE__*/React.createElement(Text, null, /*#__PURE__*/React.createElement(FixedSpacer, {
    size: 4
  })), Object.keys(data).length > 0 && /*#__PURE__*/React.createElement(Speed, {
    upload: upload,
    data: data
  })), /*#__PURE__*/React.createElement(Spacer, {
    singleLine: singleLine
  }));
};

module.exports = Fast;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVpLmpzIl0sIm5hbWVzIjpbInByb21pc2VzIiwiZG5zIiwicmVxdWlyZSIsIlJlYWN0IiwidXNlU3RhdGUiLCJ1c2VFZmZlY3QiLCJCb3giLCJUZXh0IiwiTmV3bGluZSIsInVzZUFwcCIsIlNwaW5uZXIiLCJkZWZhdWx0IiwiYXBpIiwiRml4ZWRTcGFjZXIiLCJzaXplIiwicmVwZWF0IiwiRXJyb3JNZXNzYWdlIiwidGV4dCIsIlNwYWNlciIsInNpbmdsZUxpbmUiLCJEb3dubG9hZFNwZWVkIiwiaXNEb25lIiwiZG93bmxvYWRTcGVlZCIsInVwbG9hZFNwZWVkIiwiZG93bmxvYWRVbml0IiwiY29sb3IiLCJVcGxvYWRTcGVlZCIsInVwbG9hZFVuaXQiLCJTcGVlZCIsInVwbG9hZCIsImRhdGEiLCJGYXN0IiwiZXJyb3IiLCJzZXRFcnJvciIsInNldERhdGEiLCJzZXRJc0RvbmUiLCJleGl0IiwibG9va3VwIiwiY29kZSIsIkpTT04iLCJzdHJpbmdpZnkiLCJtZWFzdXJlVXBsb2FkIiwiZm9yRWFjaCIsInJlc3VsdCIsImNhdGNoIiwiZXJyb3JfIiwibWVzc2FnZSIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFDQSxNQUFNO0FBQUNBLEVBQUFBLFFBQVEsRUFBRUM7QUFBWCxJQUFrQkMsT0FBTyxDQUFDLEtBQUQsQ0FBL0I7O0FBQ0EsTUFBTUMsS0FBSyxHQUFHRCxPQUFPLENBQUMsT0FBRCxDQUFyQjs7QUFDQSxNQUFNO0FBQUNFLEVBQUFBLFFBQUQ7QUFBV0MsRUFBQUE7QUFBWCxJQUF3QkgsT0FBTyxDQUFDLE9BQUQsQ0FBckM7O0FBQ0EsTUFBTTtBQUFDSSxFQUFBQSxHQUFEO0FBQU1DLEVBQUFBLElBQU47QUFBWUMsRUFBQUEsT0FBWjtBQUFxQkMsRUFBQUE7QUFBckIsSUFBK0JQLE9BQU8sQ0FBQyxLQUFELENBQTVDOztBQUNBLE1BQU1RLE9BQU8sR0FBR1IsT0FBTyxDQUFD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RCxDQUREO0FBaUJBLENBOUREOztBQWdFQStCLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnBCLElBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuY29uc3Qge3Byb21pc2VzOiBkbnN9ID0gcmVxdWlyZSgnZG5zJyk7XG5jb25zdCBSZWFjdCA9IHJlcXVpcmUoJ3JlYWN0Jyk7XG5jb25zdCB7dXNlU3RhdGUsIHVzZUVmZmVjdH0gPSByZXF1aXJlKCdyZWFjdCcpO1xuY29uc3Qge0JveCwgVGV4dCwgTmV3bGluZSwgdXNlQXBwfSA9IHJlcXVpcmUoJ2luaycpO1xuY29uc3QgU3Bpbm5lciA9IHJlcXVpcmUoJ2luay1zcGlubmVyJykuZGVmYXVsdDtcbmNvbnN0IGFwaSA9IHJlcXVpcmUoJy4vYXBpLmpzJyk7XG5cbmNvbnN0IEZpeGVkU3BhY2VyID0gKHtzaXplfSkgPT4gKFxuXHQ8PnsnICcucmVwZWF0KHNpemUpfTwvPlxuKTtcblxuY29uc3QgRXJyb3JNZXNzYWdlID0gKHt0ZXh0fSkgPT4gKFxuXHQ8Qm94PlxuXHRcdDxUZXh0IGJvbGQgY29sb3I9XCJyZWRcIj5cblx0XHRcdOKAulxuXHRcdFx0PEZpeGVkU3BhY2VyIHNpemU9ezF9Lz5cblx0XHQ8L1RleHQ+XG5cdFx0PFRleHQgZGltQ29sb3I+XG5cdFx0XHR7dGV4dH1cblx0XHQ8L1RleHQ+XG5cdFx0PE5ld2xpbmUgY291bnQ9ezJ9Lz5cblx0PC9Cb3g+XG4pO1xuXG5jb25zdCBTcGFjZXIgPSAoe3NpbmdsZUxpbmV9KSA9PiB7XG5cdGlmIChzaW5nbGVMaW5lKSB7XG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRyZXR1cm4gKFxuXHRcdDxUZXh0PlxuXHRcdFx0PE5ld2xpbmUgY291bnQ9ezF9Lz5cblx0XHQ8L1RleHQ+XG5cdCk7XG59O1xuXG5jb25zdCBEb3dubG9hZFNwZWVkID0gKHtpc0RvbmUsIGRvd25sb2FkU3BlZWQsIHVwbG9hZFNwZWVkLCBkb3dubG9hZFVuaXR9ID0ge30pID0+IHtcblx0Y29uc3QgY29sb3IgPSAoaXNEb25lIHx8IHVwbG9hZFNwZWVkKSA/ICdncmVlbicgOiAnY3lhbic7XG5cblx0cmV0dXJuIChcblx0XHQ8VGV4dCBjb2xvcj17Y29sb3J9PlxuXHRcdFx0e2Rvd25sb2FkU3BlZWR9XG5cdFx0XHQ8Rml4ZWRTcGFjZXIgc2l6ZT17MX0vPlxuXHRcdFx0PFRleHQgZGltQ29sb3I+e2Rvd25sb2FkVW5pdH08L1RleHQ+XG5cdFx0XHQ8Rml4ZWRTcGFjZXIgc2l6ZT17MX0vPlxuXHRcdFx04oaTXG5cdFx0PC9UZXh0PlxuXHQpO1xufTtcblxuY29uc3QgVXBsb2FkU3BlZWQgPSAoe2lzRG9uZSwgdXBsb2FkU3BlZWQsIHVwbG9hZFVuaXR9ID0ge30pID0+IHtcblx0Y29uc3QgY29sb3IgPSBpc0RvbmUgPyAnZ3JlZW4nIDogJ2N5YW4nO1xuXG5cdGlmICh1cGxvYWRTcGVlZCkge1xuXHRcdHJldHVybiAoXG5cdFx0XHQ8VGV4dCBjb2xvcj17Y29sb3J9PlxuXHRcdFx0XHR7dXBsb2FkU3BlZWR9XG5cdFx0XHRcdDxUZXh0IGRpbUNvbG9yPlxuXHRcdFx0XHRcdHtgICR7dXBsb2FkVW5pdH0g4oaRYH1cblx0XHRcdFx0PC9UZXh0PlxuXHRcdFx0PC9UZXh0PlxuXHRcdCk7XG5cdH1cblxuXHRyZXR1cm4gPFRleHQgZGltQ29sb3IgY29sb3I9e2NvbG9yfT57JyAtIE1icHMg4oaRJ308L1RleHQ+O1xufTtcblxuY29uc3QgU3BlZWQgPSAoe3VwbG9hZCwgZGF0YX0pID0+IHVwbG9hZCA/IChcblx0PD5cblx0XHQ8RG93bmxvYWRTcGVlZCB7Li4uZGF0YX0vPlxuXHRcdDxUZXh0IGRpbUNvbG9yPnsnIC8gJ308L1RleHQ+XG5cdFx0PFVwbG9hZFNwZWVkIHsuLi5kYXRhfS8+XG5cdDwvPlxuKSA6ICg8RG93bmxvYWRTcGVlZCB7Li4uZGF0YX0vPik7XG5cbmNvbnN0IEZhc3QgPSAoe3NpbmdsZUxpbmUsIHVwbG9hZH0pID0+IHtcblx0Y29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZSgnJyk7XG5cdGNvbnN0IFtkYXRhLCBzZXREYXRhXSA9IHVzZVN0YXRlKHt9KTtcblx0Y29uc3QgW2lzRG9uZSwgc2V0SXNEb25lXSA9IHVzZVN0YXRlKGZhbHNlKTtcblx0Y29uc3Qge2V4aXR9ID0gdXNlQXBwKCk7XG5cblx0dXNlRWZmZWN0KCgpID0+IHtcblx0XHQoYXN5bmMgKCkgPT4ge1xuXHRcdFx0dHJ5IHtcblx0XHRcdFx0YXdhaXQgZG5zLmxvb2t1cCgnZmFzdC5jb20nKTtcblx0XHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRcdHNldEVycm9yKGVycm9yLmNvZGUgPT09ICdFTk9URk9VTkQnID9cblx0XHRcdFx0XHQnUGxlYXNlIGNoZWNrIHlvdXIgaW50ZXJuZXQgY29ubmVjdGlvbicgOlxuXHRcdFx0XHRcdGBTb21ldGhpbmcgaGFwcGVuZWQgJHtKU09OLnN0cmluZ2lmeShlcnJvcil9YFxuXHRcdFx0XHQpO1xuXHRcdFx0XHRleGl0KCk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIHVuaWNvcm4vbm8tYXJyYXktZm9yLWVhY2hcblx0XHRcdGFwaSh7bWVhc3VyZVVwbG9hZDogdXBsb2FkfSkuZm9yRWFjaChyZXN1bHQgPT4ge1xuXHRcdFx0XHRzZXREYXRhKHJlc3VsdCk7XG5cdFx0XHR9KS5jYXRjaChlcnJvcl8gPT4geyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIHByb21pc2UvcHJlZmVyLWF3YWl0LXRvLXRoZW5cblx0XHRcdFx0c2V0RXJyb3IoZXJyb3JfLm1lc3NhZ2UpO1xuXHRcdFx0XHRleGl0KCk7XG5cdFx0XHR9KTtcblx0XHR9KSgpO1xuXHR9LCBbZXhpdCwgdXBsb2FkXSk7XG5cblx0dXNlRWZmZWN0KCgpID0+IHtcblx0XHRpZiAoZGF0YS5pc0RvbmUgfHwgKCF1cGxvYWQgJiYgZGF0YS51cGxvYWRTcGVlZCkpIHtcblx0XHRcdHNldElzRG9uZSh0cnVlKTtcblx0XHR9XG5cdH0sIFtkYXRhLmlzRG9uZSwgdXBsb2FkLCBkYXRhLnVwbG9hZFNwZWVkXSk7XG5cblx0dXNlRWZmZWN0KCgpID0+IHtcblx0XHRpZiAoaXNEb25lKSB7XG5cdFx0XHRleGl0KCk7XG5cdFx0fVxuXHR9LCBbaXNEb25lLCBleGl0XSk7XG5cblx0aWYgKGVycm9yKSB7XG5cdFx0cmV0dXJuIDxFcnJvck1lc3NhZ2UgdGV4dD17ZXJyb3J9Lz47XG5cdH1cblxuXHRyZXR1cm4gKFxuXHRcdDw+XG5cdFx0XHQ8U3BhY2VyIHNpbmdsZUxpbmU9e3NpbmdsZUxpbmV9Lz5cblx0XHRcdDxCb3g+XG5cdFx0XHRcdHshaXNEb25lICYmIChcblx0XHRcdFx0XHQ8PlxuXHRcdFx0XHRcdFx0eyFzaW5nbGVMaW5lICYmIDxUZXh0PjxGaXhlZFNwYWNlciBzaXplPXsyfS8+PC9UZXh0Pn1cblx0XHRcdFx0XHRcdDxUZXh0IGNvbG9yPVwiY3lhblwiPjxTcGlubmVyLz48L1RleHQ+XG5cdFx0XHRcdFx0XHQ8VGV4dD48Rml4ZWRTcGFjZXIgc2l6ZT17MX0vPjwvVGV4dD5cblx0XHRcdFx0XHQ8Lz5cblx0XHRcdFx0KX1cblx0XHRcdFx0e2lzRG9uZSAmJiA8VGV4dD48Rml4ZWRTcGFjZXIgc2l6ZT17NH0vPjwvVGV4dD59XG5cdFx0XHRcdHtPYmplY3Qua2V5cyhkYXRhKS5sZW5ndGggPiAwICYmIDxTcGVlZCB1cGxvYWQ9e3VwbG9hZH0gZGF0YT17ZGF0YX0vPn1cblx0XHRcdDwvQm94PlxuXHRcdFx0PFNwYWNlciBzaW5nbGVMaW5lPXtzaW5nbGVMaW5lfS8+XG5cdFx0PC8+XG5cdCk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEZhc3Q7XG4iXX0=